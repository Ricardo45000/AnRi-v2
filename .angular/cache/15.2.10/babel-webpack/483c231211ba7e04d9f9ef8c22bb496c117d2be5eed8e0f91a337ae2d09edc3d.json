{"ast":null,"code":"import pickBy from 'lodash/pickBy.js';\nimport '@aws-amplify/core/internals/utils';\nimport '../../utils/setUserAgent/constants.mjs';\nimport { isString } from '../../utils/utils.mjs';\n\n// default `autoSignIn` flag is `true`\nconst DEFAULT_AUTO_SIGN_IN = true;\nconst EMPTY_STRING = '';\nconst sanitizePhoneNumber = (dialCode, phoneNumber) => `${dialCode}${phoneNumber}`.replace(/[^A-Z0-9+]/gi, '');\nconst selectUserAttributes = (_, key) => {\n  // Allowlist of Cognito User Pool Attributes (from OpenID Connect specification)\n  // See: https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html\n  switch (key) {\n    case 'address':\n    case 'birthdate':\n    case 'email':\n    case 'family_name':\n    case 'gender':\n    case 'given_name':\n    case 'locale':\n    case 'middle_name':\n    case 'name':\n    case 'nickname':\n    case 'phone_number':\n    case 'picture':\n    case 'preferred_username':\n    case 'profile':\n    case 'updated_at':\n    case 'website':\n    case 'zoneinfo':\n      return true;\n    // Otherwise, it's a custom attribute\n    default:\n      return key.startsWith('custom:');\n  }\n};\nconst getUserAttributes = formValues => {\n  const {\n    phone_number,\n    ...userAttributes\n  } = pickBy(formValues, selectUserAttributes);\n  // only include `phone_number` attribute in `userAttributes` if it has a value\n  if (isString(phone_number) && phone_number !== EMPTY_STRING) {\n    const {\n      country_code\n    } = formValues;\n    return {\n      ...userAttributes,\n      phone_number: sanitizePhoneNumber(country_code, phone_number)\n    };\n  }\n  return userAttributes;\n};\nconst getSignUpInput = (username, formValues, loginMechanism) => {\n  const {\n    password,\n    ...values\n  } = formValues;\n  const attributes = getUserAttributes(values);\n  const options = {\n    autoSignIn: DEFAULT_AUTO_SIGN_IN,\n    userAttributes: {\n      // use `username` value for `phone_number`\n      ...(loginMechanism === 'phone_number' ? {\n        ...attributes,\n        phone_number: username\n      } : attributes)\n    }\n  };\n  return {\n    username,\n    password,\n    options\n  };\n};\nconst getUsernameSignUp = ({\n  formValues,\n  loginMechanisms\n}) => {\n  const loginMechanism = loginMechanisms[0];\n  if (loginMechanism === 'phone_number') {\n    const {\n      country_code,\n      phone_number\n    } = formValues;\n    return sanitizePhoneNumber(country_code, phone_number);\n  }\n  return formValues[loginMechanism];\n};\nexport { getSignUpInput, getUserAttributes, getUsernameSignUp, sanitizePhoneNumber };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}